

docker 安装

```
docker run --env MODE=standalone --name nacos -d -p 8848:8848 nacos/nacos-server:2.0.1 //该版本有问题
```

```
docker run --env MODE=standalone --name nacos -d -p 8848:8848 nacos/nacos-server:1.1.3
```

linux 安装

安装 jdk 

```
yum install java-1.8.0-openjdk.x86_64
```

安装 git

```
yum -y install git
```









Eureka 的最大竞争对手是 Nacos

SpringCloudAlibaba 对 SringCloud 组件进行了一些扩展

学习框架，学习思想

RPC  存在的问题

超时问题：客户端发送请求到服务端，服务端没有及时响应给客户端

连接不上：服务端已经宕机

安全问题

加密 ,https,单点登录，令牌，限流，降级，服务保护

服务与服务之间的 url 地址管理

服务治理

如果没有注册中心，会暴露一个 IP 地址和端口号，如果地址变了，会调不通，我们一般会把地址改成新的

服务与服务之间的依赖关系是非常复杂的，如果接口写死的情况下，后期接口发生变化的情况下，需要人工去修改接口，然后重新发布，效率非常低。

RPC 框架 HttpClient



注册中心基本概念

存放接口调用地址

接口地址：IP : 端口，接口名称

特点：实现动态感知，感知上线下线的服务



注册中心实现原理;

微服务架构常见名词

生产者：提供接口给其他服务调用，启动后，IP和端口号会存放到注册中心

消费者：调用其他服务的接口，根据服务名称，从注册中心查找接口地址，注册中心返回多个接口地址给消费者

注册中心：存放调用的接口和动态感知

保存，key ：服务名称，value:服务调用地址

服务注册：把当前服务的接口地址注册到注册中心

负载均衡器：消费者采用负载均衡器，在多个地址里面选择一个地址进行 RPC 远程调用，这个负载均衡是本地负载均衡，和 nginx 不同，nginx 属于服务器负载均衡



消费者调用逻辑

1、根据服务名称，从注册中心获取最新的调用接口的地址列表

2、使用本地负载均衡器，选择一个地址调用

3、使用 http 调用接口



心跳检测

如果服务宕机，就会自动剔除，消费者就不会获得调用不了的地址

服务下线原理



集群

nginx 实现集群

脑裂问题

zab协议

两阶段提交



分布式算法

Raft

ZAB

Paxos



分布式事务和分布式一致性算法区别？

分布式事务：解决系统中产生跨服务事务问题导致的分布式事务，核心是最终一致性

分布式一致性算法：解决系统集群部署之后保持每个节点的数据一致性





Raft 算法，分布式一致性协议算法

1、状态：

跟随者：参与投票，不能参与竞选

竞选者：

领导者：

2、大多数：>n/2+1/3

3、任期：每次选一个领导者，任期都会增加

4、竞选者谁的票数多，谁就能成为领导者



选举过程：

1、默认每个节点都是跟随者节点

2、每个节点会随机生成一个选举超时时间，100-300 ms

超时的时间范围内，必须等待

3、超时时间过后，当前节点可能由跟随者变为竞选者，然后给其他节点发出投票通知，如果票数过半，就会成为领导者。所以如果谁的超时时间最短，谁大概率会成为领导者角色。



如果所有节点的超时随机数都是一样，当前投票全部作废，重新进入随机生成超时时间

如果有多个节点生成的随机数相同，比较谁的票数最多，谁就是领导者

如果票数都一样，直接作废



故障重新选举

跟随者节点不能收到领导者心跳消息，跟随者就会变成竞选者，给其他节点发出投票通知，如果投票有超过过半以上，就能成为领导者。



数据如何保证一致性？

日志复制

所有写请求由领导者完成会会写入对应日志，标志状态为提交状态

为了提交日志，领导者就会将日志以心跳的状态发给跟随者，只要满足过半的跟随者响应可以写入日志，则会通知其他节点同步数据

领导者把数据同步给跟随者，也要满足过半机制





与 zab 类似，zab 是 min 和 zxid ，raft 是超时随机数。





### 参考资料

> docker 安装
>
> https://www.cnblogs.com/jeecg158/p/14029453.html

